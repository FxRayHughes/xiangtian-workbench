<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>全部应用</title>
  <script src="../../ext/vue/vue.js"></script>
  <script src="../../ext/vue/vue-router.js"></script>
  <script src="../../ext/vue/antd.min.js"></script>
  <link rel="stylesheet" href="../../ext/vue/antd.min.css"/>
  <link rel="icon" type="image/svg+xml" href="../../icons/svg/apps.svg"/>
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-eval' 'unsafe-inline'"/>
</head>
<body style=" -webkit-app-region: drag;">
<div id="appVue">
  <div style="padding: 20px; -webkit-app-region: none;">
    <div style="margin-bottom: 30px">
      <a-input-search placeholder="输入应用名称" @input="updateSearchWords" style="width: 100%" @search="onSearch"></a-input-search>
    </div>
    <div>
      <div v-if="this.searchWords===''">
        <h1>最近使用</h1>
        <a-row>
          <a-col :span="4" v-for="app in appsRecently">
            <div style="margin-bottom: 15px;text-align: center;">
              <div style="margin-bottom: 10px">
                <img @click="executeApp(app)" shape="circle" class="logo clickable" :src="app.logo"
                     :style="{'border-color':app.userThemeColor?app.userThemeColor:app.themeColor}">
              </div>
              <div class="clickable"  @click="executeApp(app)" style="white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis; ">
                {{app.name}}
              </div>
            </div>
          </a-col>
        </a-row>
      </div>
      <div v-if="this.searchWords===''" style="position: relative">
        <h1>全部应用 </h1> <div style="position:absolute;right: 0;top: 0">管理</div>
        <a-row>
          <a-col :span="4" v-for="app in apps">
            <div style="margin-bottom: 15px;text-align: center">
              <div style="margin-bottom: 10px">
                <img  @click="executeApp(app)" shape="circle" class="logo clickable" :src="app.logo"
                     :style="{'border-color':app.userThemeColor?app.userThemeColor:app.themeColor}">
              </div>
              <div class="clickable"  @click="executeApp(app)" style="white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis; ">
                {{app.name}}
              </div>
            </div>
          </a-col>
        </a-row>
      </div>
      <div v-if="this.searchWords!==''">
        <h1>搜索结果 - <span>{{searchWords}}</span></h1>
        <a-empty v-if="this.searchResult.length===0" description="暂无相关应用"></a-empty>

        <a-row>
          <a-col :span="4" v-for="app in searchResult">
            <div style="margin-bottom: 15px;text-align: center">
              <div style="margin-bottom: 10px">
                <img  @click="executeApp(app)" shape="circle" class="logo clickable"  :src="app.logo"
                     :style="{'border-color':app.userThemeColor?app.userThemeColor:app.themeColor}">
              </div>
              <div class="clickable"  @click="executeApp(app)" style="white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis; ">
                {{app.name}}
              </div>
            </div>
          </a-col>
        </a-row>
      </div>
    </div>
  </div>

</div>
<style>
  .logo {
    border-radius: 50%;
    border: 3px solid blue;
    width: 50px;
    height: 50px;
    padding: 2px;
    object-fit: cover;
  }
  h1{
    font-size: 14px;
    font-weight: bold;
    margin-bottom: 20px;
    margin-top: 10px;
  }
  .clickable{
    cursor: pointer;
  }
  body{
    user-select: none;
  }
</style>
</body>
<script>
  const tools = require('../util/util.js').tools
  const ipc = require('electron').ipcRenderer
  const saAppModel = require('../util/model/standAloneAppModel')
  tools.getWindowArgs(window)
  var appVue = new Vue({
      el: '#appVue',
      components: {},
      data() {
        return {
          apps: [],
          appsRecently:[],
          searchResult: [],
          searchWords: ''
        }
      },
    watch:{
     async searchWords(){
        console.log(this.searchWords)
       this.searchResult= await  saAppModel.find(this.searchWords,{order:'lastExecuteTime'})
       console.log(this.searchResult)
      }
    },
      mounted() {
       this.refresh()
      },
      methods: {
        onSearch(value) {
          this.searchWords = value
        },
        updateSearchWords(input){
          console.log(input)
          this.searchWords = input.target.value
          //
        },
        refresh(){
          saAppModel.getAllApps().then((data) => {
            appVue.apps = data
          })
          saAppModel.getAllApps({order:'lastExecuteTime',limit:6}).then((data) => {
            appVue.appsRecently = data
          })
        },
        executeApp(app){
          ipc.send('executeApp',{app:app})
          console.log('execteApp')
          console.log(app)
        }
      }
    }
  )
  ipc.on('refresh',()=>{
    appVue.refresh()
  })
</script>
</html>
