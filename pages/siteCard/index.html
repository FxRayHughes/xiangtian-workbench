<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>网站名片</title>
  <script src="../../ext/vue/vue.js"></script>
  <script src="../../ext/vue/antd.min.js"></script>
  <link rel="stylesheet" href="../../ext/vue/antd.min.css"/>
  <link rel="icon" type="image/svg+xml" href="../../icons/apps.svg"/>
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-eval' 'unsafe-inline'"/>
  <link rel="stylesheet" href="./card.css"/>
</head>
<body>
<div id="appVue">
  <div style="padding:15px">
    <div class="site-info">
      <a-row type="flex">
        <a-col flex="55px">
          <a-avatar shape="square" :size="40" :src="!!!tabData.favicon?'':tabData.favicon.url"></a-avatar>
        </a-col>
        <a-col :flex="3">
          <div class="site-title" :title="siteTitle">
            {{siteTitle}}
          </div>
          <div class="site-url">
            {{siteDomain}}
            <a-tooltip placement="bottom">
              <template slot="title">
                <span>以根域名作为筛选条件<br>例如bilibli.com<br>
                  将包含以下站点的内容：<br>
                  passport.bilibili.com<br>
                  www.bilibili.com<br>
                  t.bilibli.com<br>
                   ***.bilibili.com</span>
              </template>
              <a-switch checked-children="全站" un-checked-children="子站" size="small"></a-switch>
            </a-tooltip>

          </div>
        </a-col>
        <a-col :flex="2">
          <div v-if="tabData.secure">
            <a-tag color="#87d068">
              安全
            </a-tag>
          </div>
          <div v-else>
            <a-tag color="#f50">
              不安全
            </a-tag>
          </div>

        </a-col>
        <a-col :flex="1">
          <a-switch checked-children="团队" un-checked-children="个人"></a-switch>
        </a-col>
      </a-row>
    </div>
    <div>
      <a-tabs
        size="small"
         :tab-bar-gutter="0"
        default-active-key="1"
        tab-position="top"
        style=" height: calc(100vh - 72px)"
        @prevClick="callback"
        @nextClick="callback"
      >
        <a-tab-pane key="1">
          <template slot="tab">
            密码

          </template>

          <a-table :columns="pwdColumns" :data-source="pwds" size="small">
            <span slot="password" slot-scope="password">
              <span v-if="password.hide">
                ······ <a-icon type="eye" @click="show(password)"></a-icon>
              </span>
              <span v-else>
                {{password.pwd}}
              </span>
            </span>
            <span slot="action" slot-scope="text, record">
      <a>删除  </a>

    </span>
          </a-table>
        </a-tab-pane>
        <a-tab-pane key="2" tab="导航">
        </a-tab-pane>
        <a-tab-pane key="3" tab="笔记">
        </a-tab-pane>
        <a-tab-pane key="4" tab="任务">
        </a-tab-pane>
        <a-tab-pane key="5" tab="讨论">
        </a-tab-pane>
        <a-tab-pane key="6" tab="口碑">
        </a-tab-pane>
        <a-tab-pane key="7" tab="安全">
          <div v-if="tabData.secure">
            <a-tag color="#87d068">
              安全
            </a-tag>
            <p>
              此站点为安全网站，通过浏览器的基本安全校验。但也建议您不要过度信任网站，您仍然存在一定的安全风险。
            </p>
          </div>
          <div v-else>
            <a-tag color="#f50">
              不安全
            </a-tag>
            <p>
              此网站使用不安全的连接方式。对此，您可能存在信息泄露、被恶意捕捉信息、篡改等安全风险。建议您不要过于信任此网站的内容。
            </p>

          </div>
        </a-tab-pane>
      </a-tabs>
    </div>

  </div>

</div>
<style>
  .site-title {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    list-style: none;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
    width: 250px;
  }

  .site-url {
    color: #999;
    list-style: none;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
    width: 300px;
    font-size: 12px;
  }
</style>
</body>
<script>

  Vue.use(antd)
  const electron = require('electron')
  const ipc = electron.ipcRenderer
  let tools = require('../util/util.js').tools
  const appVue = new Vue({
    el: '#appVue',
    data () {
      return {
        siteUrl: '',
        siteTitle: '',
        tabData: {},
        pwds: [],
        //tab
        tabs: [
          {
            title: '密码管理',
            key: 1
          },
          {
            title: '导航收藏',
            key: 2
          }, {
            title: '笔记备忘',
            key: 3
          }, {
            title: '任务代办',
            key: 4
          }, {
            title: '社区讨论',
            key: 5
          }, {
            title: '站点口碑',
            key: 6
          }, {
            title: '安全风险',
            key: 7
          }
        ],
        pwdColumns: [

          {
            title: '标题',
            dataIndex: 'title',
            width: '100px'
          }, {
            title: '账号',
            dataIndex: 'username',
            width: '100px'
          },

          {
            title: '密码',
            dataIndex: 'password',
            width: '120px',
            scopedSlots: { customRender: 'password' }
          },
          {
            title: '操作',
            key: 'action',
            width: '100px',
            scopedSlots: { customRender: 'action' },
          }
          //,
          // {
          //   title: 'Address',
          //   dataIndex: 'address',
          // }
        ]
      }
    },
    computed: {
      siteDomain () {
        return tools.getDomainFromUrl(this.siteUrl)
      }
    },
    mounted () {
      tools.getWindowArgs(window)
      const passwordModel = require('../util/model/passwordModel')
      this.siteUrl = window.globalArgs['site-url']
      this.siteTitle = window.globalArgs['site-title']
      this.tabData = JSON.parse(decodeURIComponent(window.globalArgs['tab-data']))
      passwordModel.getSiteCredit(this.tabData.url).then((result) => {
        appVue.pwds = result
        appVue.pwds.forEach((pwd) => {
          pwd.password = {
            hide: true,
            pwd: pwd.password
          }
        })
      })

    },
    methods: {
      callback (val) {
        console.log(val)
      },
      show (password) {
        password.hide = false
      }
    }
  })
</script>
</html>
